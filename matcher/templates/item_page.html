{% extends "base.html" %}

{% block content %}
<div class="m-3">
  <div class="container">
    {% include "flash_msg.html" %}

    <h1>{{ label }} ({{ qid }})</h1>
    <ul>
      {% if item %}
      <li>place:
        {% for place in item.places %}
            <a href="{{ place.candidates_url() }}">{{ place.name }}</a>
            {%- if not loop.last %}, {% endif %}
        {% endfor %}
      </li>
      {% endif %}
      <li><a href="http://wikidata.org/wiki/{{ qid }}">view on Wikidata</a></li>
      <li><a href="http://query.wikidata.org/#{{ wikidata_query | urlencode }}">Wikidata query</a></li>
      {% if lat and lon %}
      <li>coordinates: {{ '{:.4f}'.format(lat) }}, {{ '{:.4f}'.format(lon) }}
        <a href="https://www.openstreetmap.org/#map=18/{{ lat }}/ {{ lon }}">view on OSM</a>
      </li>
      {% else %}
      <li>no coordinates for item</li>
      {% endif %}

      {% if sitelinks %}
      <li>Wikipedia:
          {% for link in sitelinks %}<a href="{{ link.url }}">{{ link.lang }}</a>
{%- if not loop.last %}, {% endif %}{% endfor %}
      </li>
      {% endif %}
      {% if 'commonswiki' in entity.sitelinks %}
      <li><a href="https://commons.wikimedia.org/wiki/{{ entity.sitelinks.commonswiki.title.replace(' ', '_') }}">Wikimedia Commons</a>
      </li>
      {% endif %}

      {% if oql %}
      <li>Overpass query: <a href="#" id="oql-toggle">show query</a>
        <pre id="oql">{{ oql }}</pre>
      </li>
      {% endif %}

    </ul>

    {#

    <h3>labels</h3>
    <pre>{{ entity['labels'] | pprint }}</pre>
    {% if entity.aliases %}
      <h3>aliases</h3>
      <pre>{{ entity.aliases | pprint }}</pre>
    {% endif %}
    <h3>site links</h3>
    <pre>{{ entity.sitelinks | pprint }}</pre>

    <h3>wikidata names</h3>
    <pre>{{ wikidata_names | pprint }}</pre>

    #}

    {% if osm_keys %}

    <h3>OpenStreetMap search criteria</h3>
    <table class="table table-responsive table-hover table-sm">
    {% for row in osm_keys %}
      <tr>
        <td>{{ row['item']['value'] }}</td>
        <td>{{ row['itemLabel']['value'] }}</td>
        <td>{{ row['tag']['value'] }}</td>
    {% endfor %}
    </table>

    {% endif %}

    {% if overpass_reply and not found %}
        <h3>overpass result</h3>
        {% if overpass_reply['elements'] | count > 10 %}
            <p>more than 10 results</p>
        {% else %}
            <pre>{{ overpass_reply['elements'] | pprint }}</pre>
        {% endif %}
    {% endif %}

    <h3>matches</h3>
    {% if not found %}
        <p>no matches found</p>
    {% else %}
      <ul>
      {% for c, m in found %}
        <li><a href="https://www.openstreetmap.org/{{ c.type }}/{{ c.id }}">
          {{ (m.osm_key + '=' + m.osm_name) if m else c.tags.name }}
        </a> ({{ c.type}})

         <a href="#" class="show_tags_link" data-key="{{ c.key }}">show all tags</a>
         <div class="all_tags" id="candidate{{ c.key }}">
           {% for k, v in c.tags|dictsort %}
            {{ k }}={{ v }}</br>
           {% endfor %}
         </div>
         </li>

        {% if 'wikidata' not in c.tags %}
          <form method="post" action="{{ url_for('add_wikidata_tag') }}">
            <input type="hidden" name="osm_id" value="{{ c.id }}" />
            <input type="hidden" name="osm_type" value="{{ c.type }}" />
            <input type="hidden" name="wikidata" value="{{ qid }}" />
            <button class="btn btn-primary" type="submit">add wikidata tag to OSM</button>
          </form>
        {% else %}
          <p>OSM already includes wikidata tag.</p>
        {% endif %}
      {% endfor %}
      </ul>
    {% endif %}

  </div>
</div>
{% endblock %}
