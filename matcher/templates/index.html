{% extends "base.html" %}

{% block content %}
<div class="jumbotron jumbotron-fluid">
  <div class="container">
  <h1 class="display-3">OSM â†” Wikidata matcher</h1>
  <p class="lead">Two great projects cataloguing the world, even more powerful when linked together.</p>
  <hr class="my-4">
  <p>Search for a place, pick one and leave the matcher to run for a few minutes. Then check out the list of matches.</p>
<form action="{{ url_for('search_results') }}" class="form-inline">
  <label for="q" class="sr-only">search:</label>
  <input class="form-control form-control-lg m-2" id="q" name="q" size="40" value="{{ q }}" placeholder="place name">
  <input type="submit" class="btn btn-success btn-lg" value="search">
</form>

</div>
</div>

<div class="container">
    <div class="card-columns">
  {% for place in existing[:24] %}
    <div class="card">
      <h5 class="card-header">
        {% if place.address.country_code == 'us' %}
            {% set name = place.name ~ ', ' ~ place.address.state %}
        {% else %}
            {% set name = place.name %}
        {% endif %}
        {% if place.state == 'overpass_timeout' %}
          {{ name }}
        {% else %}
          <a href="{{ place.candidates_url() }}">{{ name }}</a>
        {% endif %}
        <span class="text-muted small font-weight-normal">
          ({{ '{:,.1f}'.format(place.area_in_sq_km) }}km&sup2;)</span>
      </h5>
      <div class="card-block">
        {% if place.address.country_code != 'us' and place.address.country != place.name %}
            <p class="card-text">{{ place.address.country }}</p>
        {% endif %}
        <ul class="card-text list-unstyled">
        {% if place.item_count is number %}
          <li>{{ '{:,d}'.format(place.item_count) }} Wikidata items</li>
        {% endif %}
        {% if place.candidate_count is number %}
          <li>{{ '{:,d}'.format(place.candidate_count) }} matches
            ({{ '{:.1%}'.format(place.match_ratio) }})
          </li>
        {% endif %}
        </p>
      </div>
    </div>
  {% endfor %}
  </div>
  {#
  <p>The aim is for a single OSM entity to link to one Wikidata item. Many geographical entities are represented by multiple objects in OSM with the same name, for example dual carriageway bridges are mapped as two roadways, or buildings within a large site like a hospital.</p>
  <p>The matching system makes use of categories on Wikipedia because the information on Wikidata is incomplete. Wikidata includes an import of all Wikipedia including the coordinates, but for a lot of items the 'instance of' property is not set.</p>
  <p>Only Wikidata items with a page on English language Wikipedia are included in the match. In the future I'll add support for matching items without a linked Wikipedia article.</p>
  #}
</div>


{% endblock %}
